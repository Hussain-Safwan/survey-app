{"ast":null,"code":"import _regeneratorRuntime from\"/home/mah-nigga/React/ChatApp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mah-nigga/React/ChatApp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mah-nigga/React/ChatApp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer,useContext}from'react';import StreamReducer from'./StreamReducer';import StreamContext from'./StreamContext';import setAuthToken from'../../utils/setAuthToken';import AuthContext from'../auth/AuthContext';import axios from'axios';import io from'socket.io-client';import{CREATE_STREAM,JOIN_STREAM,GET_STREAM,SEND_MESSAGE,CHOOSE_STREAM,DELETE_STREAM,UPDATE_STREAM}from'../types';var socket=io('http://localhost:5000');var StreamState=function StreamState(props){var initialState={current:null,streams:[],currentMessage:null,loading:true};var _useReducer=useReducer(StreamReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var authContext=useContext(AuthContext);var user=authContext.user;socket.on('new message',function(data){renderMessages(data);});var renderMessages=function renderMessages(data){dispatch({type:'RENDER_MESSAGES',payload:data});};var getStream=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!user){_context.next=5;break;}_context.next=3;return axios.get(\"http://localhost:5000/streams/\".concat(user._id));case 3:res=_context.sent;dispatch({type:GET_STREAM,payload:res.data});case 5:case\"end\":return _context.stop();}}},_callee);}));return function getStream(){return _ref.apply(this,arguments);};}();var resetCurrent=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(data);dispatch({type:'SET_CURRENT',payload:data});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function resetCurrent(_x){return _ref2.apply(this,arguments);};}();var selectStream=function selectStream(stream){dispatch({type:CHOOSE_STREAM,payload:stream});};var sendMessage=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(obj){var config,formData,current;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!user){_context3.next=9;break;}config={headers:{'Content-Type':'application/json'}};formData=obj.formData,current=obj.current;formData.sender_id=user._id;formData.sender_name=user.name;console.log(formData);_context3.next=8;return axios.post('http://localhost:5000/streams/send',formData,config);case 8:dispatch({type:SEND_MESSAGE,payload:obj});case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function sendMessage(_x2){return _ref3.apply(this,arguments);};}();var createStream=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(title){var config,formData,res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:config={headers:{'Content-Type':'application/json'}};if(!user){_context4.next=7;break;}formData={title:title.title,owner_id:user._id,owner_name:user.name};_context4.next=5;return axios.post('http://localhost:5000/streams/create',formData,config);case 5:res=_context4.sent;dispatch({type:CREATE_STREAM,payload:formData});case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function createStream(_x3){return _ref4.apply(this,arguments);};}();var deleteStream=function deleteStream(formData){dispatch({type:DELETE_STREAM,payload:formData});};var updateStream=function updateStream(formData){dispatch({type:UPDATE_STREAM,payload:formData});};var joinStream=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(link){var url,res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:url=\"http://localhost:5000/streams/join/\".concat(link,\"/\").concat(user._id);_context5.next=3;return axios.get(url);case 3:res=_context5.sent;console.log(res.data.newStream);dispatch({type:JOIN_STREAM,payload:res.data.newStream});case 6:case\"end\":return _context5.stop();}}},_callee5);}));return function joinStream(_x4){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(StreamContext.Provider,{value:{streams:state.streams,messages:state.messages,current:state.current,currentMessage:state.currentMessage,loading:state.loading,getStream:getStream,sendMessage:sendMessage,selectStream:selectStream,resetCurrent:resetCurrent,createStream:createStream,deleteStream:deleteStream,updateStream:updateStream,joinStream:joinStream}},props.children);};export default StreamState;// { _id:\n//     {\n//        _data:\n//       '825EF6D4C7000000022B022C0100296E5A1004CA7A3AFA58AE47DB892DD7E6C4E65B2046645F696400645EF4C261B6054E32AB4DE74D0004'\n//     },\n//      operationType: 'update',\n//      clusterTime: Timestamp { _bsontype: 'Timestamp', low_: 2, high_: 1593234631 },\n//      ns: { \n//        db: 'NiggaByte', \n//        coll: 'streams' \n//       },\n//      documentKey: { \n//        _id: 5ef4c261b6054e32ab4de74d \n//     },\n//      updateDescription: { \n//         updatedFields: { 'messages.13': [Object] },\n//         removedFields: [] \n//       } \n// }","map":{"version":3,"sources":["/home/mah-nigga/React/ChatApp/client/src/context/streams/StreamState.js"],"names":["React","useReducer","useContext","StreamReducer","StreamContext","setAuthToken","AuthContext","axios","io","CREATE_STREAM","JOIN_STREAM","GET_STREAM","SEND_MESSAGE","CHOOSE_STREAM","DELETE_STREAM","UPDATE_STREAM","socket","StreamState","props","initialState","current","streams","currentMessage","loading","state","dispatch","authContext","user","on","data","renderMessages","type","payload","getStream","get","_id","res","resetCurrent","console","log","selectStream","stream","sendMessage","obj","config","headers","formData","sender_id","sender_name","name","post","createStream","title","owner_id","owner_name","deleteStream","updateStream","joinStream","link","url","newStream","messages","children"],"mappings":"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","sourcesContent":["import React, { useReducer, useContext } from 'react'\nimport StreamReducer from './StreamReducer'\nimport StreamContext from './StreamContext'\nimport setAuthToken from '../../utils/setAuthToken'\nimport AuthContext from '../auth/AuthContext'\n\nimport axios from 'axios'\nimport io from 'socket.io-client'\n\nimport {\n  CREATE_STREAM,\n  JOIN_STREAM,\n  GET_STREAM,\n  SEND_MESSAGE,\n  CHOOSE_STREAM,\n  DELETE_STREAM,\n  UPDATE_STREAM\n} from '../types'\n\nconst socket = io('http://localhost:5000')\n\nconst StreamState = props => {\n  const initialState = {\n    current: null,\n    streams: [],\n    currentMessage: null,\n    loading: true\n  }\n\n  const [state, dispatch] = useReducer(StreamReducer, initialState)\n\n  const authContext = useContext(AuthContext)\n  const { user } = authContext\n\n  socket.on('new message', data => {\n    renderMessages(data)\n  })\n\n  const renderMessages = data => {\n    dispatch({\n      type: 'RENDER_MESSAGES',\n      payload: data\n    })\n  }\n\n  const getStream = async () => {\n    if (user) {\n      const res = await axios.get(`http://localhost:5000/streams/${user._id}`)\n      dispatch({\n        type: GET_STREAM,\n        payload: res.data\n      })\n    }\n  }\n\n  const resetCurrent = async data => {\n    console.log(data)\n    dispatch({\n      type: 'SET_CURRENT',\n      payload: data\n    })\n  }\n\n  const selectStream = stream => {\n    dispatch({\n      type: CHOOSE_STREAM,\n      payload: stream\n    })\n  }\n\n  const sendMessage = async obj => {\n    if (user) {\n\n      const config = {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }\n      const { formData, current } = obj\n      formData.sender_id = user._id\n      formData.sender_name = user.name\n      console.log(formData)\n\n      await axios.post('http://localhost:5000/streams/send', formData, config)\n\n      dispatch({\n        type: SEND_MESSAGE,\n        payload: obj\n      })\n    }\n  }\n\n  const createStream = async title => {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }\n    if (user) {\n      const formData = {\n        title: title.title,\n        owner_id: user._id,\n        owner_name: user.name\n      }\n      const res = await axios.post('http://localhost:5000/streams/create', formData, config)\n      dispatch({\n        type: CREATE_STREAM,\n        payload: formData\n      })\n    }\n  }\n\n  const deleteStream = formData => {\n    dispatch({\n      type: DELETE_STREAM,\n      payload: formData\n    })\n  }\n\n  const updateStream = formData => {\n    dispatch({\n      type: UPDATE_STREAM,\n      payload: formData\n    })\n  }\n\n  const joinStream = async link => {\n    const url = `http://localhost:5000/streams/join/${link}/${user._id}`\n    const res = await axios.get(url)\n    console.log(res.data.newStream)\n    dispatch({\n      type: JOIN_STREAM,\n      payload: res.data.newStream\n    })\n  }\n\n  return (\n    <StreamContext.Provider \n      value={{\n        streams: state.streams,\n        messages: state.messages,\n        current: state.current,\n        currentMessage: state.currentMessage,\n        loading: state.loading,\n        getStream,\n        sendMessage,\n        selectStream,\n        resetCurrent,\n        createStream,\n        deleteStream,\n        updateStream,\n        joinStream\n      }}\n    >\n      { props.children }\n    </StreamContext.Provider>\n  )\n}\n\nexport default StreamState\n\n\n// { _id:\n//     {\n//        _data:\n//       '825EF6D4C7000000022B022C0100296E5A1004CA7A3AFA58AE47DB892DD7E6C4E65B2046645F696400645EF4C261B6054E32AB4DE74D0004'\n//     },\n//      operationType: 'update',\n//      clusterTime: Timestamp { _bsontype: 'Timestamp', low_: 2, high_: 1593234631 },\n//      ns: { \n//        db: 'NiggaByte', \n//        coll: 'streams' \n//       },\n//      documentKey: { \n//        _id: 5ef4c261b6054e32ab4de74d \n//     },\n//      updateDescription: { \n//         updatedFields: { 'messages.13': [Object] },\n//         removedFields: [] \n//       } \n// }"]},"metadata":{},"sourceType":"module"}